<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>一个平庸的码农 | 自定义元素简介</title>
    <meta name="description" content="一个平庸的码农">
    <link rel="icon" href="/static/logo.png" type="image/png" sizes="256x256">
  <link rel="icon" href="/static/logo.svg" type="image/svg+xml" sizes="any">
  <link rel="stylesheet" href="/static/fontello.css">
    
    <link rel="preload" href="/assets/css/0.styles.26aa3aca.css" as="style"><link rel="preload" href="/assets/js/app.0a45ff1b.js" as="script"><link rel="preload" href="/assets/js/17.38280e73.js" as="script"><link rel="prefetch" href="/assets/js/27.9fcb215d.js"><link rel="prefetch" href="/assets/js/1.45f8bb8d.js"><link rel="prefetch" href="/assets/js/2.bf994553.js"><link rel="prefetch" href="/assets/js/3.338bbe13.js"><link rel="prefetch" href="/assets/js/4.e060e9a9.js"><link rel="prefetch" href="/assets/js/5.70ef3704.js"><link rel="prefetch" href="/assets/js/6.135ce61a.js"><link rel="prefetch" href="/assets/js/7.f5359c2d.js"><link rel="prefetch" href="/assets/js/8.69c36941.js"><link rel="prefetch" href="/assets/js/9.5d2be0e1.js"><link rel="prefetch" href="/assets/js/10.d34b6e37.js"><link rel="prefetch" href="/assets/js/11.6db84992.js"><link rel="prefetch" href="/assets/js/12.33701182.js"><link rel="prefetch" href="/assets/js/13.e4160eec.js"><link rel="prefetch" href="/assets/js/14.2ae320c6.js"><link rel="prefetch" href="/assets/js/15.131b9097.js"><link rel="prefetch" href="/assets/js/16.2945f391.js"><link rel="prefetch" href="/assets/js/18.c5433ac3.js"><link rel="prefetch" href="/assets/js/19.8b78eb06.js"><link rel="prefetch" href="/assets/js/20.d17b46ca.js"><link rel="prefetch" href="/assets/js/21.fab1c4fb.js"><link rel="prefetch" href="/assets/js/22.c3a6f120.js"><link rel="prefetch" href="/assets/js/23.cf5e76b7.js"><link rel="prefetch" href="/assets/js/24.9a8609f7.js"><link rel="prefetch" href="/assets/js/25.1f3d28ac.js"><link rel="prefetch" href="/assets/js/26.41cfdef6.js"><link rel="prefetch" href="/assets/js/28.2ffdd37d.js"><link rel="prefetch" href="/assets/js/29.4f506617.js"><link rel="prefetch" href="/assets/js/30.eb97053c.js"><link rel="prefetch" href="/assets/js/31.69479a66.js"><link rel="prefetch" href="/assets/js/32.c2f4df7d.js"><link rel="prefetch" href="/assets/js/33.73513e10.js"><link rel="prefetch" href="/assets/js/34.bcb8b6c9.js"><link rel="prefetch" href="/assets/js/35.212fa17c.js"><link rel="prefetch" href="/assets/js/36.a6c8d008.js"><link rel="prefetch" href="/assets/js/37.e5e5771d.js"><link rel="prefetch" href="/assets/js/38.b8fa5698.js"><link rel="prefetch" href="/assets/js/39.cb2c4151.js"><link rel="prefetch" href="/assets/js/40.542dd4ff.js"><link rel="prefetch" href="/assets/js/41.47928c59.js"><link rel="prefetch" href="/assets/js/42.c4a065be.js"><link rel="prefetch" href="/assets/js/43.b4013db9.js"><link rel="prefetch" href="/assets/js/44.7f301537.js"><link rel="prefetch" href="/assets/js/45.6f91d3c0.js"><link rel="prefetch" href="/assets/js/46.d70b48df.js"><link rel="prefetch" href="/assets/js/47.a5ee1f6b.js"><link rel="prefetch" href="/assets/js/48.225937f7.js"><link rel="prefetch" href="/assets/js/49.c5b2e981.js"><link rel="prefetch" href="/assets/js/50.c812b4fb.js"><link rel="prefetch" href="/assets/js/51.6e92ee37.js"><link rel="prefetch" href="/assets/js/52.b807e79f.js"><link rel="prefetch" href="/assets/js/53.69969303.js"><link rel="prefetch" href="/assets/js/54.b8c64a9c.js"><link rel="prefetch" href="/assets/js/55.03ea8a19.js">
    <link rel="stylesheet" href="/assets/css/0.styles.26aa3aca.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      一个平庸的码农
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/posts/" class="nav-link router-link-active">吹水</a></div><div class="nav-item"><a href="/books/" class="nav-link">图书</a></div><div class="nav-item"><a href="/projects/" class="nav-link">小玩意</a></div><div class="nav-item"><a href="/slides/" class="nav-link">投影片</a></div><div class="nav-item"><a href="/music/" class="nav-link">音乐</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">社区</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="https://github.com/myst729" target="_blank" rel="noopener noreferrer" class="nav-link">GitHub</a></li><li class="dropdown-item"><!----><a href="https://stackoverflow.com/users/1032492" target="_blank" rel="noopener noreferrer" class="nav-link">StackOverflow</a></li></ul></div></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/posts/" class="nav-link router-link-active">吹水</a></div><div class="nav-item"><a href="/books/" class="nav-link">图书</a></div><div class="nav-item"><a href="/projects/" class="nav-link">小玩意</a></div><div class="nav-item"><a href="/slides/" class="nav-link">投影片</a></div><div class="nav-item"><a href="/music/" class="nav-link">音乐</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">社区</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="https://github.com/myst729" target="_blank" rel="noopener noreferrer" class="nav-link">GitHub</a></li><li class="dropdown-item"><!----><a href="https://stackoverflow.com/users/1032492" target="_blank" rel="noopener noreferrer" class="nav-link">StackOverflow</a></li></ul></div></div><!----></nav><!----></div><div class="page"><div class="content"><h1 id="自定义元素简介"><a href="#自定义元素简介" aria-hidden="true" class="header-anchor">#</a> 自定义元素简介</h1><blockquote><p>本文翻译自 <a href="http://webcomponents.org/articles/introduction-to-custom-elements/" target="_blank" rel="noopener noreferrer">Introduction to Custom Elements</a>，经 <a href="http://weibo.com/itchina100" target="_blank" rel="noopener noreferrer">@裕波</a> 大大授意，发布于 <a href="http://www.w3ctech.com/topic/867" target="_blank" rel="noopener noreferrer">w3ctech</a>。本文篇幅较短，并未涵盖自定义元素全部的内容。了解更多细节，可以阅读我之前翻译的另一篇文章<a href="/posts/2013/custom-elements-defining-new-elements-in-html.html">《自定义元素：在 HTML 中定义新元素》</a>。</p></blockquote><p>HTML 是 Web 平台最重要的元素。它提供了各种构造站点和应用程序的底层特性。但是，一旦你开始用原生 HTML 标签实现一个复杂的组件，很容易就会变成 <code>div</code> 标签的堆砌。假如 Web 平台允许你创建自己的原始组件会怎样？假如你可以随意选择标签名会怎样？加入你可以扩展已有 HTML 标签的特性会怎样？自定义元素（Custom Elements）就允许你做这些事情。</p><p><video src="/blog/media/2015/eiji-kitamura-web-components-custom-elements.mp4" poster="/blog/images/2015/03/customelements-cover.jpg" preload="metadata" controls="controls"></video></p><h2 id="什么是自定义元素？"><a href="#什么是自定义元素？" aria-hidden="true" class="header-anchor">#</a> 什么是自定义元素？</h2><p>自定义元素能让开发者创建自定义的 HTML 标签，并用于他们的网站和应用程序，使得组件复用变得更容易。</p><h2 id="如何构建一个自定义元素"><a href="#如何构建一个自定义元素" aria-hidden="true" class="header-anchor">#</a> 如何构建一个自定义元素</h2><p>定义一个自定义元素很简单。只要以标签名为第一个参数，调用 <code>document.registerElement()</code>。</p><pre class="language-js"><code><span class="token keyword">var</span> XComponent <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">registerElement</span><span class="token punctuation">(</span><span class="token string">'x-component'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>现在你就可以在文档中任何地方使用 <code>&lt;x-component&gt;</code> 了。</p><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-component</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-component</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>提示：<code>&lt;x-component&gt;</code> 在文档中的位置可以位于自定义元素的定义执行之前。细节请参阅 <a href="http://www.html5rocks.com/en/tutorials/webcomponents/customelements/" target="_blank" rel="noopener noreferrer">HTML5Rocks 的这篇文章</a>。</p><p>要检测自定义元素是否可用，可以检查 <code>document.registerElement</code> 是否存在。或者你可以直接加载 <a href="http://webcomponents.org/polyfills/" target="_blank" rel="noopener noreferrer"><code>webcomponents.js</code></a>。</p><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>bower_components/webcomponentsjs/webcomponents.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><h3 id="命名规则"><a href="#命名规则" aria-hidden="true" class="header-anchor">#</a> 命名规则</h3><p>你的自定义元素的名字当中必须至少有一个“<code>-</code>”。任何不含“<code>-</code>”的标签名都会导致错误。</p><p>好的命名</p><ul><li>x-component</li><li>x-web-component</li></ul><p>不好的命名</p><ul><li>web_component</li><li>xelement</li><li>XElement</li></ul><h3 id="命令式用法"><a href="#命令式用法" aria-hidden="true" class="header-anchor">#</a> 命令式用法</h3><p>通过向 HTML 插入 <code>&lt;x-component&gt;</code> 标签，可以声明式的使用定义好的自定义标签，但你也可以采用命令的用法。</p><pre class="language-js"><code><span class="token keyword">var</span> XComponent <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">registerElement</span><span class="token punctuation">(</span><span class="token string">'x-component'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> dom <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>dom<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>上面的例子就使用 <code>new</code> 实例化了一个自定义元素。</p><pre class="language-js"><code>document<span class="token punctuation">.</span><span class="token function">registerElement</span><span class="token punctuation">(</span><span class="token string">'x-component'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> dom <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'x-component'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>dom<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>这个例子使用 <code>document.createElement()</code> 实例化了一个自定义元素。</p><h2 id="向自定义元素添加特性"><a href="#向自定义元素添加特性" aria-hidden="true" class="header-anchor">#</a> 向自定义元素添加特性</h2><p>能够使用自定义的标签名挺不错，但这还不够。我们再给这个元素加一些特性。</p><p>为了给自定义元素增加特性，你首先需要以 <code>HTMLElement.prototype</code> 为参数调用 <code>Object.create()</code>，创建一个基本的原型对象。你会得到一个空的原型对象，其原型链上已经设置了基本的 HTML 元素特性。向这个原型对象添加任何你想要的方法和属性，然后把这个原型传入 <code>document.registerElement</code>，如下所示：</p><pre class="language-js"><code><span class="token keyword">var</span> proto <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>HTMLElement<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>
proto<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'自定义元素'</span><span class="token punctuation">;</span>
proto<span class="token punctuation">.</span><span class="token function-variable function">alert</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'我是'</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span><span class="token function">registerElement</span><span class="token punctuation">(</span><span class="token string">'x-component'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  prototype<span class="token punctuation">:</span> proto
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="自定义元素结构"><a href="#自定义元素结构" aria-hidden="true" class="header-anchor">#</a> 自定义元素结构</h3><p>我们用 Chrome 开发者工具来看看自定义元素里面都是什么。在“元素”面板观察我们刚创建的 <code>x-component</code> 标签。你可以看到 <code>x-component</code> 是一个 <code>x-component</code> 原型的实例，而后者又是 <code>HTMLElement</code> 原型的实例。</p><p><img src="/blog/images/2015/03/customelements-inherit.png" alt="自定义元素结构"></p><h2 id="类型扩展自定义元素"><a href="#类型扩展自定义元素" aria-hidden="true" class="header-anchor">#</a> 类型扩展自定义元素</h2><p>你可以创建一个扩展原生 HTML 元素特性的自定义的元素。这就是所谓的类型扩展自定义元素。要使用这个元素，可以在原始的标签上用 <code>is</code> 属性指定自定义的标签名称。</p><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">is</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>x-component<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>要定义一个类型扩展：</p><ul><li>使用要扩展元素的原型创建基本原型对象，而不是 <code>HTMLElement</code>。</li><li>在 <code>document.registerElement()</code> 的第二个参数中添加一个 <code>extends</code> 属性，指定要扩展元素的标签名称。</li></ul><p>下面是一段扩展 <code>input</code> 元素的示例代码：</p><pre class="language-js"><code><span class="token keyword">var</span> XComponent <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">registerElement</span><span class="token punctuation">(</span><span class="token string">'x-component'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token keyword">extends</span><span class="token punctuation">:</span> <span class="token string">'input'</span><span class="token punctuation">,</span>
  prototype<span class="token punctuation">:</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>HTMLInputElement<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>注意 <code>extends: 'input'</code>，它的原型是基于 <code>HTMLInputElement</code>，而不是 <code>HTMLElement</code>。现在你可以在文档中使用 <code>&lt;input is=&quot;x-component&quot;&gt;</code> 了。这样，你就能在基本的 <code>input</code> 元素特性上扩展 API。</p><p>提示：你可能会好奇，假如为“<code>extends</code>”和“<code>prototype</code>”设置不同的元素，会发生什么。没错，有这个可能，还可能会导致意外的结果。但根据我的经验，不会有什么有价值的东西。</p><h3 id="github-的用例"><a href="#github-的用例" aria-hidden="true" class="header-anchor">#</a> GitHub 的用例</h3><p>类型扩展自定义元素的目的是什么？我们来看看 GitHub 这个现成的绝佳例子。</p><p><img src="/blog/images/2015/03/customelements-relativetime.png" alt="实时类型扩展"></p><p>GitHub 有很多显示日期和时间的组件。注意，它们不是绝对的日期和世界，而是相对于浏览器的当前时间。你应该能想象如何计算，但 GitHub 却用类型扩展自定义元素 <code>time-elements</code> 来做这件事。</p><p>看看它怎么工作的。</p><p><img src="/blog/images/2015/03/customelements-time.png" alt="time 元素"></p><p>有四件事需要注意：</p><ul><li><code>time</code> 标签被当作基本元素使用</li><li><code>datetime</code> 属性表示了绝对的日期和时间</li><li><code>relative-time</code> 被指定为一个类型扩展</li><li><code>TextContent</code> 表示了相对的日期和时间</li></ul><p>作为一个类型扩展，这是实时地从绝对日期和时间（<code>datetime</code>）属性计算出相对日期和时间。</p><p>使用类型扩展自定义元素的好处在于，即使浏览器未开启 JavaScript，或者不支持自定义元素（以及补丁），<code>time</code> 元素仍会显示备用的日期和时间信息，保持了它的语义。试试用开发者工具关闭 JavaScript；你会发现它显示的是绝对的日期和时间。</p><p>关于 <code>time-elements</code> 更多细节，请阅读 webcomponents.org 的文章 <a href="http://webcomponents.org/articles/interview-with-joshua-peek/" target="_blank" rel="noopener noreferrer">GitHub 在生产中如何使用 Web Components</a>。</p><h2 id="生命周期回调方法"><a href="#生命周期回调方法" aria-hidden="true" class="header-anchor">#</a> 生命周期回调方法</h2><p>前面提到的 <code>relative-time</code> 自定义元素向 <code>TextContent</code> 实时地插入相对的日期和时间信息。但这是什么时候发生的？你可以定义一些在自定义元素产生特定事件时调用，被称为“生命周期回调方法”的函数。</p><p>下面列出了这些声明周期回调方法：</p><ul><li>元素创建后调用 <code>.createdCallback()</code>；</li><li>元素附加到文档后调用 <code>.attachedCallback()</code>；</li><li>从文档中移除元素后调用 <code>.detachedCallback()</code>；</li><li>元素任一属性变更后调用 <code>.attributeChangedCallback()</code>。</li></ul><p>在 <code>relative-time</code> 的例子中，就用了 <code>.createdCallback()</code> 和 <code>.attributeChangedCallback()</code> 向 <code>TextContent</code> 插入相对的日期和时间。</p><h3 id="示例"><a href="#示例" aria-hidden="true" class="header-anchor">#</a> 示例</h3><p>要使用生命周期回调方法，只要在注册自定义元素时，把函数定义成原型对象的属性。</p><pre class="language-js"><code><span class="token keyword">var</span> proto <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>HTMLElement<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>
proto<span class="token punctuation">.</span><span class="token function-variable function">createdCallback</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> div <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  div<span class="token punctuation">.</span>textContent <span class="token operator">=</span> <span class="token string">'我是自定义元素'</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>div<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> XComponent <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">registerElement</span><span class="token punctuation">(</span><span class="token string">'x-component'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  prototype<span class="token punctuation">:</span> proto
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h2 id="自定义元素与模板和-shadow-dom-结合"><a href="#自定义元素与模板和-shadow-dom-结合" aria-hidden="true" class="header-anchor">#</a> 自定义元素与模板和 Shadow DOM 结合</h2><p>在自定义元素中使用模板和 Shadow DOM，可以让组件的操控和复用更容易。有了模板，就能声明式地定义你的自定义元素的内容。有了 Shadow DOM，内容的样式、ID 和类就能以其自身为作用域。</p><p>创建自定义元素时，你可以通过 <code>.createdCallback()</code> 来应用它们。我们来看一段示例代码。要学习模板和 Shadow DOM，请阅读之前的相关文章（<a href="http://webcomponents.org/articles/introduction-to-template-element" target="_blank" rel="noopener noreferrer">模板</a>、<a href="http://webcomponents.org/articles/introduction-to-shadow-dom" target="_blank" rel="noopener noreferrer">Shadow DOM</a>）。</p><p><strong>HTML</strong></p><pre class="language-html"><code><span class="token comment">&lt;!-- 定义模板 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>template<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style language-css">
    ...
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>http://webcomponents.org/img/logo.svg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>content</span> <span class="token attr-name">select</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>h1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>content</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><pre class="language-html"><code><span class="token comment">&lt;!-- 使用自定义元素 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-component</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>我是自定义元素<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-component</span><span class="token punctuation">&gt;</span></span>
</code></pre><p><strong>JavaScript</strong></p><pre class="language-js"><code><span class="token keyword">var</span> proto <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>HTMLElement<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>
proto<span class="token punctuation">.</span><span class="token function-variable function">createdCallback</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 添加一个 Shadow DOM</span>
  <span class="token keyword">var</span> root <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createShadowRoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 添加一个模板</span>
  <span class="token keyword">var</span> template <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#template'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> clone <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">importNode</span><span class="token punctuation">(</span>template<span class="token punctuation">.</span>content<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  root<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>clone<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> XComponent <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">registerElement</span><span class="token punctuation">(</span><span class="token string">'x-component'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  prototype<span class="token punctuation">:</span> proto
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p><a href="http://jsbin.com/yugoka/3/edit?html,js,output" target="_blank" rel="noopener noreferrer">这里还有一个例子。</a></p><h2 id="浏览器支持"><a href="#浏览器支持" aria-hidden="true" class="header-anchor">#</a> 浏览器支持</h2><p>Chrome 和 Opera 都支持自定义元素。2014 年 11 月起，Firefox 开启标示后也支持了。要检查其可用性，可以访问 <a href="https://www.chromestatus.com/features/4642138092470272" target="_blank" rel="noopener noreferrer">chromestatus.com</a> 或 <a href="http://caniuse.com/#feat=custom-elements" target="_blank" rel="noopener noreferrer">caniuse.com</a>。要支持其他浏览器，可以使用 <a href="http://webcomponents.org/polyfills/" target="_blank" rel="noopener noreferrer">webcomponents.js</a>（原名 <a href="https://github.com/Polymer/platform" target="_blank" rel="noopener noreferrer">platform.js</a>）。</p><h2 id="资料"><a href="#资料" aria-hidden="true" class="header-anchor">#</a> 资料</h2><p>自定义元素就讲到这里。<a href="http://webcomponents.org/articles/interview-with-joshua-peek/" target="_blank" rel="noopener noreferrer">你可能也注意到了</a>，GitHub 就使用了自定义元素，并借助补丁实现了对 IE9 的支持。现在就看你的了。</p><p>如果你有兴趣了解更多自定义元素的知识，请参阅：</p><ul><li><a href="http://www.html5rocks.com/en/tutorials/webcomponents/customelements/" target="_blank" rel="noopener noreferrer">自定义元素：在 HTML 中定义新元素 - HTML5Rocks</a>（<a href="http://www.html5rocks.com/zh/tutorials/webcomponents/customelements/" target="_blank" rel="noopener noreferrer">译文 1</a>、<a href="/posts/2013/custom-elements-defining-new-elements-in-html.html">译文 2</a>）</li><li><a href="http://w3c.github.io/webcomponents/spec/custom/" target="_blank" rel="noopener noreferrer">自定义元素规范标准</a></li></ul></div><!----><!----></div></div></div>
    <script src="/assets/js/17.38280e73.js" defer></script><script src="/assets/js/app.0a45ff1b.js" defer></script>
  </body>
</html>
