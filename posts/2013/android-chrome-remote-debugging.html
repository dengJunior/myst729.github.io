<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>一个平庸的码农 | Android 设备 Chrome 远程调试</title>
    <meta name="description" content="一个平庸的码农">
    <link rel="icon" href="/static/logo.png" type="image/png" sizes="256x256">
  <link rel="icon" href="/static/logo.svg" type="image/svg+xml" sizes="any">
  <link rel="stylesheet" href="/static/fontello.css">
    
    <link rel="preload" href="/assets/css/0.styles.ea168385.css" as="style"><link rel="preload" href="/assets/js/app.d4ce6780.js" as="script"><link rel="preload" href="/assets/js/39.25d82b38.js" as="script"><link rel="prefetch" href="/assets/js/28.ab8ea044.js"><link rel="prefetch" href="/assets/js/1.460b6d99.js"><link rel="prefetch" href="/assets/js/2.4585c69e.js"><link rel="prefetch" href="/assets/js/3.560fc6c4.js"><link rel="prefetch" href="/assets/js/4.b8e26cb0.js"><link rel="prefetch" href="/assets/js/5.a4031868.js"><link rel="prefetch" href="/assets/js/6.9508ab9a.js"><link rel="prefetch" href="/assets/js/7.fa73cd7e.js"><link rel="prefetch" href="/assets/js/8.de02dda4.js"><link rel="prefetch" href="/assets/js/9.4f05d119.js"><link rel="prefetch" href="/assets/js/10.ee35eaa0.js"><link rel="prefetch" href="/assets/js/11.2af52383.js"><link rel="prefetch" href="/assets/js/12.9cd5fd43.js"><link rel="prefetch" href="/assets/js/13.dfe3a00b.js"><link rel="prefetch" href="/assets/js/14.3476e7ae.js"><link rel="prefetch" href="/assets/js/15.e4be0105.js"><link rel="prefetch" href="/assets/js/16.5ea9c46d.js"><link rel="prefetch" href="/assets/js/17.b80775b3.js"><link rel="prefetch" href="/assets/js/18.d7b44c49.js"><link rel="prefetch" href="/assets/js/19.018a17cd.js"><link rel="prefetch" href="/assets/js/20.e7784bab.js"><link rel="prefetch" href="/assets/js/21.20740583.js"><link rel="prefetch" href="/assets/js/22.efb6ef79.js"><link rel="prefetch" href="/assets/js/23.b4bd3298.js"><link rel="prefetch" href="/assets/js/24.d5547775.js"><link rel="prefetch" href="/assets/js/25.46c855ac.js"><link rel="prefetch" href="/assets/js/26.d85c22d8.js"><link rel="prefetch" href="/assets/js/27.96361ded.js"><link rel="prefetch" href="/assets/js/29.2085f5ec.js"><link rel="prefetch" href="/assets/js/30.4f6ac586.js"><link rel="prefetch" href="/assets/js/31.57541ec8.js"><link rel="prefetch" href="/assets/js/32.dee6b356.js"><link rel="prefetch" href="/assets/js/33.72192c86.js"><link rel="prefetch" href="/assets/js/34.d1d397ef.js"><link rel="prefetch" href="/assets/js/35.131246cc.js"><link rel="prefetch" href="/assets/js/36.c62769a3.js"><link rel="prefetch" href="/assets/js/37.dbb122e4.js"><link rel="prefetch" href="/assets/js/38.2f4b3c78.js"><link rel="prefetch" href="/assets/js/40.f02cae42.js"><link rel="prefetch" href="/assets/js/41.85ab936e.js"><link rel="prefetch" href="/assets/js/42.1f378e94.js"><link rel="prefetch" href="/assets/js/43.d5c77d52.js"><link rel="prefetch" href="/assets/js/44.2f53e3cf.js"><link rel="prefetch" href="/assets/js/45.e8c2e103.js"><link rel="prefetch" href="/assets/js/46.42dd2bbd.js"><link rel="prefetch" href="/assets/js/47.600ab990.js"><link rel="prefetch" href="/assets/js/48.78c3d5fd.js"><link rel="prefetch" href="/assets/js/49.9fba5340.js"><link rel="prefetch" href="/assets/js/50.e2483df2.js"><link rel="prefetch" href="/assets/js/51.1ce8a129.js"><link rel="prefetch" href="/assets/js/52.d711cd4e.js"><link rel="prefetch" href="/assets/js/53.c7803802.js"><link rel="prefetch" href="/assets/js/54.bae792ff.js"><link rel="prefetch" href="/assets/js/55.7feea50b.js"><link rel="prefetch" href="/assets/js/56.2f16289f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ea168385.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      一个平庸的码农
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/posts/" class="nav-link router-link-active">吹水</a></div><div class="nav-item"><a href="/books/" class="nav-link">图书</a></div><div class="nav-item"><a href="/projects/" class="nav-link">小玩意</a></div><div class="nav-item"><a href="/slides/" class="nav-link">投影片</a></div><div class="nav-item"><a href="/music/" class="nav-link">音乐</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">社区</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="https://github.com/myst729" target="_blank" rel="noopener noreferrer" class="nav-link">GitHub</a></li><li class="dropdown-item"><!----><a href="https://stackoverflow.com/users/1032492" target="_blank" rel="noopener noreferrer" class="nav-link">StackOverflow</a></li></ul></div></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/posts/" class="nav-link router-link-active">吹水</a></div><div class="nav-item"><a href="/books/" class="nav-link">图书</a></div><div class="nav-item"><a href="/projects/" class="nav-link">小玩意</a></div><div class="nav-item"><a href="/slides/" class="nav-link">投影片</a></div><div class="nav-item"><a href="/music/" class="nav-link">音乐</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">社区</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="https://github.com/myst729" target="_blank" rel="noopener noreferrer" class="nav-link">GitHub</a></li><li class="dropdown-item"><!----><a href="https://stackoverflow.com/users/1032492" target="_blank" rel="noopener noreferrer" class="nav-link">StackOverflow</a></li></ul></div></div><!----></nav><!----></div><div class="page"><div class="content"><h1 id="android-设备-chrome-远程调试"><a href="#android-设备-chrome-远程调试" aria-hidden="true" class="header-anchor">#</a> Android 设备 Chrome 远程调试</h1><p><img src="https://myst729.github.io/blog/images/2013/07/android-chrome-remote-debugging.jpg" alt="Android Chrome Remote Debugging"></p><p>随着智能手机的普及，移动设备的浏览器功能越来越强大，我们用手机上网时，看到的再也不是难看的 wap 页面了。移动页面越来越复杂，随之而来的就是前端开发者需要面对更多开发和调试的问题。回想十年前，web 前端开发的工具十分匮乏，这种窘境一直持续到 <a href="http://www.mozilla.org/firefox/" target="_blank" rel="noopener noreferrer">Firefox</a> 和 <a href="http://getfirebug.com/" target="_blank" rel="noopener noreferrer">Firebug</a> 出现，才算是有了起色。</p><p>移动 web 前端开发毫不意外的重演了这段历史。两年前我刚接触智能移动设备 web 开发时，Android 还在 2.x 版本。当时的情况非常艰苦，文档稀缺，几乎没有辅助的 web 开发和调试工具，加上 Android 系统自身也有很多坑，web 前端调试苦不堪言。那时候我们最常用的调试方法是大家都非常熟悉的“alert 大法”，也就是把需要的信息通过 <code>alert()</code> 函数显示在页面弹出的对话框里。</p><p><img src="https://myst729.github.io/blog/images/2013/07/alert-log.png" alt="alert log"></p><p>是不是有点时光倒流的感觉？不过“alert 大法”也有很多问题，比如它会打断 UI 交互，阻塞代码执行，因此我们很快抛弃了它，转而使用自己手写的，嵌入页面的控制台。</p><p><img src="https://myst729.github.io/blog/images/2013/07/in-page-console.png" alt="in-page Console"></p><p>这个控制台（其实只是信息输出）虽然功能非常弱，相比桌面浏览器现有的调试工具落后了十万八千里，但比起“alert 大法”也算是有比较大地改善了。</p><p>相对于以前的 web 开发者而言，今天的移动 web 开发者要幸福得多。除了移动浏览器对 web 标准较高的支持程度，开发者们等待工具的时间更是大大缩短了。近两年陆续出现了一些移动浏览器的远程调试工具，使得我们可以通过 PC 上开启的控制台，调试手机浏览器中正在运行的代码，比如较早出现的 <a href="http://people.apache.org/~pmuellr/weinre/" target="_blank" rel="noopener noreferrer">weinre</a>、iOS 平台上非常受欢迎的 <a href="http://www.iunbug.com/mihtool" target="_blank" rel="noopener noreferrer">MIHTool</a>（国人作品），目前功能还比较搓的 <a href="http://html.adobe.com/edge/inspect/" target="_blank" rel="noopener noreferrer">Adobe Edge Inspect CC</a> 等。除此之外，浏览器厂商也纷纷推出自己的调试工具，比如 <a href="http://dev.opera.com/articles/view/remote-debugging-with-opera-dragonfly/" target="_blank" rel="noopener noreferrer">Opera Mobile 可以借助桌面的 Opera Dragonfly 实现远程调试</a>，<a href="http://developer.apple.com/library/ios/#documentation/AppleApplications/Reference/SafariWebContent/DebuggingSafarioniPhoneContent/DebuggingSafarioniPhoneContent.html" target="_blank" rel="noopener noreferrer">iOS Safari 可以在 Mac OS X 系统中进行调试</a>。运行于 Android 4+ 系统的 Chrome for Android 同样也可以<a href="https://developers.google.com/chrome-developer-tools/docs/remote-debugging" target="_blank" rel="noopener noreferrer">配合 ADB（Android Debug Bridge）实现桌面远程调试</a>。</p><p>今天我们就来了解一下如何进行 Chrome for Android 的远程调试。</p><p>开始之前，先做一些准备工作：</p><ol><li>在手机上访问 Google Play 商店，安装 <a href="https://play.google.com/store/apps/details?id=com.android.chrome" target="_blank" rel="noopener noreferrer">Chrome for Android</a>。</li></ol><p><img src="https://myst729.github.io/blog/images/2013/07/chrome-for-android.png" alt="Chrome for Android"></p><ol start="2"><li>到 Android 开发者中心下载 <a href="http://developer.android.com/sdk/index.html" target="_blank" rel="noopener noreferrer">ADT Bundle</a>。</li></ol><p><img src="https://myst729.github.io/blog/images/2013/07/android-developer-tools.png" alt="Android Developer Tools"></p><ol start="3"><li>解压后打开 SDK Manager，确保 Platform-tools 已安装。</li></ol><p><img src="https://myst729.github.io/blog/images/2013/07/sdk-platform-tools.png" alt="SDK Platform-tools"></p><ol start="4"><li>通过 USB 线缆把手机连接到 PC，并开启系统设置中的 USB 调试。</li></ol><p><img src="https://myst729.github.io/blog/images/2013/07/android-usb-debug.png" alt="Android USB Debug"></p><ol start="5"><li>开启 Chrome 设置中的 USB 调试选项。</li></ol><p><img src="https://myst729.github.io/blog/images/2013/07/chrome-usb-debug.png" alt="Chrome USB Debug"></p><p>准备就绪，终于可以开始了。</p><p>打开命令行工具，运行 platform tools 中的 ADB (Android Debug Bridge)，在选定的端口号启动 Chrome 远程调试工具。</p><pre class="language-bash"><code>adb forward tcp:9919 localabstract:chrome_devtools_remote
</code></pre><p>输入的指令比较长，注意不要敲错了。成功后可以看到守护进程已经运行起来了：</p><p><img src="https://myst729.github.io/blog/images/2013/07/start-daemon.png" alt="Start Daemon"></p><p>如果守护进程没有运行成功，可以输入 <code>adb kill-server</code>，重新试一次。ADB 必须带参数运行。如果直接输入 adb 就会打开它的帮助，可以看到各种参数的用法。比如输入 <code>adb devices</code> 就会列出当前通过 USB 连接到 PC 的所有设备：</p><p><img src="https://myst729.github.io/blog/images/2013/07/devices-list.png" alt="Devices List"></p><p>在手机上用 Chrome 随便打开几个网页：</p><p><img src="https://myst729.github.io/blog/images/2013/07/android-chrome.png" alt="Android Chrome"></p><p>打开 PC 端的 Chrome 访问 <strong>http://localhost:9919/</strong>（端口号就是刚才启动远程调试时使用的端口号），应该可以看到手机 Chrome 已经打开页面的缩略图：</p><p><img src="https://myst729.github.io/blog/images/2013/07/inspectable-pages.png" alt="Inspectable Pages"></p><p>任意点击一个缩略图…… 页面打不开！</p><p><img src="https://myst729.github.io/blog/images/2013/07/gfwed.png" alt="GFWed"></p><p>原因是 <em>appspot.com</em> 很早以前就被墙掉了，所以我们还得自备梯子。翻过墙以后，终于看到了远程调试页面，和 Chrome 内置的调试工具一模一样：</p><p><img src="https://myst729.github.io/blog/images/2013/07/pc-inspector-1.png" alt="PC Inspector 1"></p><p>同时可以观察到手机上 Chrome 对调试工具的响应：</p><p><img src="https://myst729.github.io/blog/images/2013/07/android-inspected-1.png" alt="Android Inspected 1"></p><p>改改样式试试：</p><p><img src="https://myst729.github.io/blog/images/2013/07/pc-inspector-2.png" alt="PC Inspector 2"></p><p>手机 Chrome 中的页面立刻反映出了变化：</p><p><img src="https://myst729.github.io/blog/images/2013/07/android-inspected-2.png" alt="Android Inspected 2"></p><p>打开控制台执行 JavaScript：</p><p><img src="https://myst729.github.io/blog/images/2013/07/pc-inspector-3.png" alt="PC Inspector 3"></p><p>也没有问题：</p><p><img src="https://myst729.github.io/blog/images/2013/07/android-inspected-3.png" alt="Android Inspected 3"></p><p>好了，写到这里，你应该清楚接下去要怎么玩弄它了吧……</p><p>补充：</p><ol><li><p>其实 ADT Bundle 这个大家伙是 Android 应用开发的一整套工具，而我们需要用的只是一个 ADB。因此如果你不打算做原生应用开发，并且有可靠的来源得到 ADB，完全可以不下载 ADT Bundle。</p></li><p></p><li><p>~~翻墙后看到的调试界面和 Chrome 内置的调试工具非常像，那我们能不能直接调用内置的调试工具，从而免去翻墙的周折呢？答案是可以的，只需要替换远程调试页面的协议和路径。比如原先需要翻墙的地址是：<strong>http://chrome-devtools-frontend.appspot.com/static/28.0.1500.64/devtools.html</strong>?ws=localhost:9919/devtools/page/6C75490A-5E7A-DA49-A82B-5CD233CAF1B1，只要把加粗的部分替换成 <strong>chrome-devtools://devtools/devtools.html</strong>，就可以不用翻墙直接打开。~~改协议的路子已经被堵死了，同学们还是老老实实翻墙吧……</p></li></ol><p><img src="https://myst729.github.io/blog/images/2013/07/pc-inspector-4.png" alt="PC Inspector 4"></p><ol start="3"><li>最近 Chrome Web Store 推出了一个新的 Chrome 扩展，就叫 <a href="https://chrome.google.com/webstore/detail/adb/dpngiggdglpdnjdoaefidgiigpemgage" target="_blank" rel="noopener noreferrer">ADB</a>。安装这个扩展后，我们既不需要下载庞大的 ADT Bundle，也不用在命令行输入那些难记的指令，只要点几下鼠标就可以开始远程调试！具体的用法请看<a href="https://developers.google.com/chrome-developer-tools/docs/remote-debugging#remote-debugging-beta" target="_blank" rel="noopener noreferrer">这里</a>。</li></ol><p><img src="https://myst729.github.io/blog/images/2013/07/adb-plugin.png" alt="ADB plugin"></p><p>~~这个扩展目前只支持桌面的 Chrome beta、dev 和 canary 分支，不过我认为这只是时间问题，相信过不了多久稳定版 Chrome 也可以用上它了。~~好消息，最新的稳定版 Chrome 已经可以正常使用 ADB 插件了。从 Android 4.4 (KitKat) 开始，原生应用中的 WebView 也可以通过 ADB 来调试了。</p><p>（完）</p></div><!----><!----></div></div></div>
    <script src="/assets/js/39.25d82b38.js" defer></script><script src="/assets/js/app.d4ce6780.js" defer></script>
  </body>
</html>
