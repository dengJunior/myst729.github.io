<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>一个平庸的码农 | 自定义元素：在 HTML 中定义新元素</title>
    <meta name="description" content="一个平庸的码农">
    <link rel="icon" href="/static/logo.png" type="image/png" sizes="256x256">
  <link rel="icon" href="/static/logo.svg" type="image/svg+xml" sizes="any">
  <link rel="stylesheet" href="/static/fontello.css">
    
    <link rel="preload" href="/assets/css/0.styles.ea168385.css" as="style"><link rel="preload" href="/assets/js/app.d4ce6780.js" as="script"><link rel="preload" href="/assets/js/37.dbb122e4.js" as="script"><link rel="prefetch" href="/assets/js/28.ab8ea044.js"><link rel="prefetch" href="/assets/js/1.460b6d99.js"><link rel="prefetch" href="/assets/js/2.4585c69e.js"><link rel="prefetch" href="/assets/js/3.560fc6c4.js"><link rel="prefetch" href="/assets/js/4.b8e26cb0.js"><link rel="prefetch" href="/assets/js/5.a4031868.js"><link rel="prefetch" href="/assets/js/6.9508ab9a.js"><link rel="prefetch" href="/assets/js/7.fa73cd7e.js"><link rel="prefetch" href="/assets/js/8.de02dda4.js"><link rel="prefetch" href="/assets/js/9.4f05d119.js"><link rel="prefetch" href="/assets/js/10.ee35eaa0.js"><link rel="prefetch" href="/assets/js/11.2af52383.js"><link rel="prefetch" href="/assets/js/12.9cd5fd43.js"><link rel="prefetch" href="/assets/js/13.dfe3a00b.js"><link rel="prefetch" href="/assets/js/14.3476e7ae.js"><link rel="prefetch" href="/assets/js/15.e4be0105.js"><link rel="prefetch" href="/assets/js/16.5ea9c46d.js"><link rel="prefetch" href="/assets/js/17.b80775b3.js"><link rel="prefetch" href="/assets/js/18.d7b44c49.js"><link rel="prefetch" href="/assets/js/19.018a17cd.js"><link rel="prefetch" href="/assets/js/20.e7784bab.js"><link rel="prefetch" href="/assets/js/21.20740583.js"><link rel="prefetch" href="/assets/js/22.efb6ef79.js"><link rel="prefetch" href="/assets/js/23.b4bd3298.js"><link rel="prefetch" href="/assets/js/24.d5547775.js"><link rel="prefetch" href="/assets/js/25.46c855ac.js"><link rel="prefetch" href="/assets/js/26.d85c22d8.js"><link rel="prefetch" href="/assets/js/27.96361ded.js"><link rel="prefetch" href="/assets/js/29.2085f5ec.js"><link rel="prefetch" href="/assets/js/30.4f6ac586.js"><link rel="prefetch" href="/assets/js/31.57541ec8.js"><link rel="prefetch" href="/assets/js/32.dee6b356.js"><link rel="prefetch" href="/assets/js/33.72192c86.js"><link rel="prefetch" href="/assets/js/34.d1d397ef.js"><link rel="prefetch" href="/assets/js/35.131246cc.js"><link rel="prefetch" href="/assets/js/36.c62769a3.js"><link rel="prefetch" href="/assets/js/38.2f4b3c78.js"><link rel="prefetch" href="/assets/js/39.25d82b38.js"><link rel="prefetch" href="/assets/js/40.f02cae42.js"><link rel="prefetch" href="/assets/js/41.85ab936e.js"><link rel="prefetch" href="/assets/js/42.1f378e94.js"><link rel="prefetch" href="/assets/js/43.d5c77d52.js"><link rel="prefetch" href="/assets/js/44.2f53e3cf.js"><link rel="prefetch" href="/assets/js/45.e8c2e103.js"><link rel="prefetch" href="/assets/js/46.42dd2bbd.js"><link rel="prefetch" href="/assets/js/47.600ab990.js"><link rel="prefetch" href="/assets/js/48.78c3d5fd.js"><link rel="prefetch" href="/assets/js/49.9fba5340.js"><link rel="prefetch" href="/assets/js/50.e2483df2.js"><link rel="prefetch" href="/assets/js/51.1ce8a129.js"><link rel="prefetch" href="/assets/js/52.d711cd4e.js"><link rel="prefetch" href="/assets/js/53.c7803802.js"><link rel="prefetch" href="/assets/js/54.bae792ff.js"><link rel="prefetch" href="/assets/js/55.7feea50b.js"><link rel="prefetch" href="/assets/js/56.2f16289f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ea168385.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      一个平庸的码农
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/posts/" class="nav-link router-link-active">吹水</a></div><div class="nav-item"><a href="/books/" class="nav-link">图书</a></div><div class="nav-item"><a href="/projects/" class="nav-link">小玩意</a></div><div class="nav-item"><a href="/slides/" class="nav-link">投影片</a></div><div class="nav-item"><a href="/music/" class="nav-link">音乐</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">社区</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="https://github.com/myst729" target="_blank" rel="noopener noreferrer" class="nav-link">GitHub</a></li><li class="dropdown-item"><!----><a href="https://stackoverflow.com/users/1032492" target="_blank" rel="noopener noreferrer" class="nav-link">StackOverflow</a></li></ul></div></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/posts/" class="nav-link router-link-active">吹水</a></div><div class="nav-item"><a href="/books/" class="nav-link">图书</a></div><div class="nav-item"><a href="/projects/" class="nav-link">小玩意</a></div><div class="nav-item"><a href="/slides/" class="nav-link">投影片</a></div><div class="nav-item"><a href="/music/" class="nav-link">音乐</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">社区</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="https://github.com/myst729" target="_blank" rel="noopener noreferrer" class="nav-link">GitHub</a></li><li class="dropdown-item"><!----><a href="https://stackoverflow.com/users/1032492" target="_blank" rel="noopener noreferrer" class="nav-link">StackOverflow</a></li></ul></div></div><!----></nav><!----></div><div class="page"><div class="content"><h1 id="自定义元素：在-html-中定义新元素"><a href="#自定义元素：在-html-中定义新元素" aria-hidden="true" class="header-anchor">#</a> 自定义元素：在 HTML 中定义新元素</h1><blockquote><p>本文翻译自 <a href="http://www.html5rocks.com/en/tutorials/webcomponents/customelements/" target="_blank" rel="noopener noreferrer">Custom Elements: defining new elements in HTML</a>（需翻墙），已于 2014 年 1 月 8 日修订后提交至 <a href="http://www.html5rocks.com/zh/tutorials/webcomponents/customelements/" target="_blank" rel="noopener noreferrer">HTML5Rocks</a>。</p><p>补充；由于相关规范尚在演化中，译文介绍的内容可能失效。如果遇到这种情况请查阅原文最新的修订版本。</p></blockquote><h2 id="本文目录"><a href="#本文目录" aria-hidden="true" class="header-anchor">#</a> 本文目录</h2><ul><li>引言
<ul><li>时髦的标记，行动起来！</li></ul></li><li>赶紧开始吧
<ul><li>注册新元素</li><li>扩展原生元素</li><li>元素如何提升
<ul><li>Unresolved 元素</li></ul></li></ul></li><li>实例化元素
<ul><li>实例化自定义标签</li><li>实例化类型扩展元素</li></ul></li><li>添加 JS 属性和方法
<ul><li>生命周期回调方法</li></ul></li><li>添加标记
<ul><li>用 Shadow DOM 封装内部实现</li><li>从模板创建元素</li></ul></li><li>为自定义元素增加样式
<ul><li>为使用 Shadow DOM 的元素增加样式</li><li>使用 <code>:unresolved</code> 伪类避免无样式内容闪烁（FOUC）</li></ul></li><li>历史和浏览器支持
<ul><li>特性检测</li><li>浏览器支持</li><li><code>HTMLElementElement</code> 怎么了？</li></ul></li><li>结语</li></ul><p><strong>注意！这篇文章介绍的 API 尚未完全标准化，并且仍在变动中，在项目中使用这些实验性 API 时请务必谨慎。</strong></p><h2 id="引言"><a href="#引言" aria-hidden="true" class="header-anchor">#</a> 引言</h2><p>现在的 web 严重缺乏表达能力。你只要瞧一眼“现代”的 web 应用，比如 GMail，就会明白我的意思：</p><blockquote><img src="https://myst729.github.io/blog/images/2013/09/gmail.png" class="lone-block"><p>（图：现代 web 应用：使用 <code>&lt;div&gt;</code> 堆砌而成。）</p></blockquote><p>堆砌 <code>&lt;div&gt;</code> 一点都不现代。然而可悲的是，这就是我们构建 web 应用的方式。在现有基础上我们不应该有更高的追求吗？</p><h3 id="时髦的标记，行动起来！"><a href="#时髦的标记，行动起来！" aria-hidden="true" class="header-anchor">#</a> 时髦的标记，行动起来！</h3><p>HTML 为我们提供了一个完美的文档组织工具，然而 <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/" target="_blank" rel="noopener noreferrer">HTML 规范</a>定义的元素却很有限。</p><p>假如 GMail 的标记不那么糟糕，而是像下面这样漂亮，那会怎样？</p><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hangout-module</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hangout-chat</span> <span class="token attr-name">from</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Paul, Addy<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hangout-discussion</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hangout-message</span> <span class="token attr-name">from</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Paul<span class="token punctuation">&quot;</span></span> <span class="token attr-name">profile</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>profile.png<span class="token punctuation">&quot;</span></span> <span class="token attr-name">profile</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>118075919496626375791<span class="token punctuation">&quot;</span></span> <span class="token attr-name">datetime</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>2013-07-17T12:02<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Feelin’ this Web Components thing.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Heard of it?<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>hangout-message</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>hangout-discussion</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>hangout-chat</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hangout-chat</span><span class="token punctuation">&gt;</span></span>...<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>hangout-chat</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>hangout-module</span><span class="token punctuation">&gt;</span></span>
</code></pre><p><a href="https://myst729.github.io/blog/examples/hangouts-on-polymer" target="_blank" rel="noopener noreferrer">查看演示！</a></p><p>真是令人耳目一新！这个应用太合理了，既<strong>有意义</strong>，又<strong>容易理解</strong>。最妙的是，它是<strong>可维护</strong>的，只要查看声明结构就可以清楚地知道它的作用。</p><blockquote><p>自定义元素，救救我们！就指望你了！</p></blockquote><h2 id="赶紧开始吧"><a href="#赶紧开始吧" aria-hidden="true" class="header-anchor">#</a> 赶紧开始吧</h2><p><a href="http://w3c.github.io/webcomponents/spec/custom/" target="_blank" rel="noopener noreferrer">自定义元素</a><strong>允许开发者定义新的 HTML 元素类型</strong>。该规范只是 <a href="http://w3c.github.io/webcomponents/explainer/" target="_blank" rel="noopener noreferrer">Web 组件</a>模块提供的众多新 API 中的一个，但它也很可能是最重要的一个。没有自定义元素带来的以下特性，Web 组件都不会存在：</p><ol><li>定义新的 HTML/DOM 元素</li><li>基于其他元素创建扩展元素</li><li>给一个标签绑定一组自定义功能</li><li>扩展已有 DOM 元素的 API</li></ol><h3 id="注册新元素"><a href="#注册新元素" aria-hidden="true" class="header-anchor">#</a> 注册新元素</h3><p>使用 <code>document.registerElement()</code> 可以创建一个自定义元素：</p><pre class="language-js"><code><span class="token keyword">var</span> XFoo <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">registerElement</span><span class="token punctuation">(</span><span class="token string">'x-foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">XFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p><code>document.registerElement()</code> 的第一个参数是元素的标签名。这个标签名<strong>必须包括一个连字符（-）</strong>。因此，诸如 <code>&lt;x-tags&gt;</code>、<code>&lt;my-element&gt;</code> 和 <code>&lt;my-awesome-app&gt;</code> 都是合法的标签名，而 <code>&lt;tabs&gt;</code> 和 <code>&lt;foo_bar&gt;</code> 则不是。这个限定使解析器能很容易地区分自定义元素和 HTML 规范定义的元素，同时确保了 HTML 增加新标签时的向前兼容。</p><p>第二个参数是一个（可选的）对象，用于描述该元素的 <code>prototype</code>。在这里可以为元素添加自定义功能（例如：公开属性和方法）。稍后详述。</p><p>自定义元素默认继承自 <code>HTMLElement</code>，因此上一个示例等同于：</p><pre class="language-js"><code><span class="token keyword">var</span> XFoo <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">registerElement</span><span class="token punctuation">(</span><span class="token string">'x-foo'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  prototype<span class="token punctuation">:</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>HTMLElement<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>调用 <code>document.registerElement('x-foo')</code> 向浏览器注册了这个新元素，并返回一个可以用来创建 <code>&lt;x-foo&gt;</code> 元素实例的构造器。如果你不想使用构造器，也可以使用其他实例化元素的技术。</p><p>**提示：**如果你不希望在 <code>window</code> 全局对象中创建元素构造器，还可以把它放进命名空间：</p><pre class="language-js"><code><span class="token keyword">var</span> myapp <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
myapp<span class="token punctuation">.</span>XFoo <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">registerElement</span><span class="token punctuation">(</span><span class="token string">'x-foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="扩展原生元素"><a href="#扩展原生元素" aria-hidden="true" class="header-anchor">#</a> 扩展原生元素</h3><p>假设平淡无奇的原生 <code>&lt;button&gt;</code> 元素不能满足你的需求，你想将其增强为一个“超级按钮”，可以通过创建一个继承 <code>HTMLButtonElement.prototype</code> 的新元素，来扩展 <code>&lt;button&gt;</code> 元素：</p><pre class="language-js"><code><span class="token keyword">var</span> MegaButton <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">registerElement</span><span class="token punctuation">(</span><span class="token string">'mega-button'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  prototype<span class="token punctuation">:</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>HTMLButtonElement<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token keyword">extends</span><span class="token punctuation">:</span> <span class="token string">'button'</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p><strong>提示：<strong>要创建扩展自</strong>元素 B</strong> 的<strong>元素 A</strong>，<strong>元素 A</strong> 必须继承<strong>元素 B</strong> 的 <code>prototype</code>。</p><p>这类自定义元素被称为<em>类型扩展自定义元素</em>。它们以继承某个特定 <code>HTMLElement</code> 的方式表达了“元素 X 是一个 Y”。</p><p>示例：</p><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">is</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>mega-button<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre><h3 id="元素如何提升"><a href="#元素如何提升" aria-hidden="true" class="header-anchor">#</a> 元素如何提升</h3><p>你有没有想过为什么 HTML 解析器对非标准标签不报错？比如，我们在页面中声明一个 <code>&lt;randomtag&gt;</code>，一切都很和谐。根据 <a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/elements.html#htmlunknownelement" target="_blank" rel="noopener noreferrer">HTML 规范</a>的表述：</p><blockquote><p>非规范定义的元素必须使用 <code>HTMLUnknownElement</code> 接口。
<cite> - HTML 规范</cite></p></blockquote><p><code>&lt;randomtag&gt;</code> 是非标准的，它会继承 <code>HTMLUnknownElement</code>。</p><p>对自定义元素来说，情况就不一样了。**拥有合法元素名的自定义元素将继承 <code>HTMLElement</code>。**你可以按 <kbd>Ctrl</kbd> + <kbd>Shift</kbd> + <kbd>J</kbd>（Mac 系统为 <kbd>⌘</kbd> + <kbd>Option</kbd> + <kbd>J</kbd>）打开控制台，运行下面这段代码，得到的结果将是 <code>true</code>：</p><pre class="language-js"><code><span class="token comment">// “tabs”不是一个合法的自定义元素名</span>
document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'tabs'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> HTMLUnknownElement<span class="token punctuation">.</span>prototype

<span class="token comment">// “x-tabs”是一个合法的自定义元素名</span>
document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'x-tabs'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__proto__ <span class="token operator">==</span> HTMLElement<span class="token punctuation">.</span>prototype
</code></pre><p>**注意：**在不支持 <code>document.registerElement()</code> 的浏览器中，<code>&lt;x-tabs&gt;</code> 仍为 <code>HTMLUnknownElement</code>。</p><h4 id="unresolved-元素"><a href="#unresolved-元素" aria-hidden="true" class="header-anchor">#</a> Unresolved 元素</h4><p>由于自定义元素是通过脚本执行 <code>document.registerElement()</code> 注册的，因此 <strong>它们可能在元素定义被注册到浏览器<em>之前</em>就已经声明或创建过了</strong>。例如：你可以先在页面中声明 <code>&lt;x-tabs&gt;</code>，以后再调用 <code>document.registerElement('x-tabs')</code>。</p><p>在被提升到其定义之前，这些元素被称为 <strong>unresolved 元素</strong>。它们是拥有合法自定义元素名的 HTML 元素，只是还没有注册成为自定义元素。</p><p>下面这个表格看起来更直观一些：</p><table><thead><tr><th>类型</th><th>继承自</th><th>示例</th></tr></thead><tbody><tr><td>unresolved</td><td><code>HTMLElement</code></td><td><code>&lt;x-tabs&gt;</code>、<code>&lt;my-element&gt;</code>、<code>&lt;my-awesome-app&gt;</code></td></tr><tr><td>未知元素</td><td><code>HTMLUnknownElement</code></td><td><code>&lt;tabs&gt;</code>、<code>&lt;foo_bar&gt;</code></td></tr></tbody></table><blockquote><p>把 unresolved 元素想象成尚处于中间状态，它们都是等待被浏览器提升的潜在候选者。浏览器说：“你具备一个新元素的全部特征，我保证会在赋予你定义的时候将你提升为一个元素”。</p></blockquote><h2 id="实例化元素"><a href="#实例化元素" aria-hidden="true" class="header-anchor">#</a> 实例化元素</h2><p>我们创建普通元素用到的一些技术也可以用于自定义元素。和所有标准定义的元素一样，自定义元素既可以在 HTML 中声明，也可以通过 JavaScript 在 DOM 中创建。</p><h3 id="实例化自定义标签"><a href="#实例化自定义标签" aria-hidden="true" class="header-anchor">#</a> 实例化自定义标签</h3><p><strong>声明</strong>元素：</p><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-foo</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-foo</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>在 JS 中<strong>创建 DOM</strong>：</p><pre class="language-js"><code><span class="token keyword">var</span> xFoo <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'x-foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
xFoo<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'Thanks!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>使用 <strong><code>new</code> 操作符</strong>：</p><pre class="language-js"><code><span class="token keyword">var</span> xFoo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">XFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>xFoo<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><h3 id="实例化类型扩展元素"><a href="#实例化类型扩展元素" aria-hidden="true" class="header-anchor">#</a> 实例化类型扩展元素</h3><p>实例化类型扩展自定义元素的方法和自定义标签惊人地相似。</p><p><strong>声明</strong>元素：</p><pre class="language-html"><code><span class="token comment">&lt;!-- &lt;button&gt; “是一个”超级按钮 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">is</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>mega-button<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre><p>在 JS 中<strong>创建 DOM</strong>：</p><pre class="language-js"><code><span class="token keyword">var</span> megaButton <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">,</span> <span class="token string">'mega-button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// megaButton instanceof MegaButton === true</span>
</code></pre><p>看，这是接收第二个参数为 <code>is=&quot;&quot;</code> 属性的 <code>document.createElement()</code> 重载版本。</p><p>使用 <strong><code>new</code> 操作符</strong>：</p><pre class="language-js"><code><span class="token keyword">var</span> megaButton <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MegaButton</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>megaButton<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>现在，我们已经学习了如何使用 <code>document.registerElement()</code> 来向浏览器注册一个新标签。但这还不够，接下来我们要向新标签添加属性和方法。</p><h2 id="添加-js-属性和方法"><a href="#添加-js-属性和方法" aria-hidden="true" class="header-anchor">#</a> 添加 JS 属性和方法</h2><p>自定义元素最强大的地方在于，你可以在元素定义中加入属性和方法，给元素绑定特定的功能。你可以把它想象成一种给你的元素创建公开 API 的方法。</p><p>这里有一个完整的示例：</p><pre class="language-js"><code><span class="token keyword">var</span> XFooProto <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>HTMLElement<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 1. 为 x-foo 创建 foo() 方法</span>
XFooProto<span class="token punctuation">.</span><span class="token function-variable function">foo</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'foo() called'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 2. 定义一个只读的“bar”属性</span>
Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>XFooProto<span class="token punctuation">,</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>value<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 3. 注册 x-foo 的定义</span>
<span class="token keyword">var</span> XFoo <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">registerElement</span><span class="token punctuation">(</span><span class="token string">'x-foo'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>prototype<span class="token punctuation">:</span> XFooProto<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 4. 创建一个 x-foo 实例</span>
<span class="token keyword">var</span> xfoo <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'x-foo'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 5. 插入页面</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>xfoo<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>构造 <code>prototype</code> 的方法多种多样，如果你不喜欢上面这种方式，再看一个更简洁的例子：</p><pre class="language-js"><code><span class="token keyword">var</span> XFoo <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">registerElement</span><span class="token punctuation">(</span><span class="token string">'x-foo'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  prototype<span class="token punctuation">:</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>HTMLElement<span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token punctuation">{</span>
    bar<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      <span class="token keyword">get</span><span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    foo<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      value<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'foo() called'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>以上两种方式，第一种使用了 ES5 的 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty" target="_blank" rel="noopener noreferrer"><code>Object.defineProperty</code></a>，第二种则使用了 <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Operators/get" target="_blank" rel="noopener noreferrer">get/set</a>。</p><h3 id="生命周期回调方法"><a href="#生命周期回调方法" aria-hidden="true" class="header-anchor">#</a> 生命周期回调方法</h3><p>元素可以定义特殊的方法，来注入其生存期内关键的时间点。这些方法各自有特定的名称和用途，它们被恰如其分地命名为<strong>生命周期回调</strong>：</p><table><thead><tr><th>回调名称</th><th>调用时间点</th></tr></thead><tbody><tr><td><code>createdCallback</code></td><td>创建元素实例</td></tr><tr><td><code>attachedCallback</code></td><td>向文档插入实例</td></tr><tr><td><code>detachedCallback</code></td><td>从文档中移除实例</td></tr><tr><td><code>attributeChangedCallback(attrName, oldVal, newVal)</code></td><td>添加，移除，或修改一个属性</td></tr></tbody></table><p>**示例：**为 <code>&lt;x-foo&gt;</code> 定义 <code>createdCallback()</code> 和 <code>attachedCallback()</code>：</p><pre class="language-js"><code><span class="token keyword">var</span> proto <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>HTMLElement<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>

proto<span class="token punctuation">.</span><span class="token function-variable function">createdCallback</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
proto<span class="token punctuation">.</span><span class="token function-variable function">attachedCallback</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> XFoo <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">registerElement</span><span class="token punctuation">(</span><span class="token string">'x-foo'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>prototype<span class="token punctuation">:</span> proto<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p><strong>所有生命周期回调都是可选的</strong>，你可以只在需要关注的时间点定义它们。例如：假设你有一个很复杂的元素，它会在 <code>createdCallback()</code> 打开一个 IndexedDB 连接。在将其从 DOM 移除时，<code>detachedCallback()</code> 会做一些必要的清理工作。**注意：**不要过于依赖这些生命周期方法（比如用户直接关闭浏览器标签），仅将其作为可能的优化点。</p><p>另一个生命周期回调的例子是为元素设置默认的事件监听器：</p><pre class="language-js"><code>proto<span class="token punctuation">.</span><span class="token function-variable function">createdCallback</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'Thanks!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><blockquote><p>如果你的元素太笨重，是不会有人用它的。生命周期回调可以帮你大忙！</p></blockquote><h2 id="添加标记"><a href="#添加标记" aria-hidden="true" class="header-anchor">#</a> 添加标记</h2><p>我们已经创建好 <code>&lt;x-foo&gt;</code> 并添加了 JavaScript API，但它还没有任何内容。不如我们给点 HTML 让它渲染？</p><p>生命周期回调在这个时候就派上用场了。我们甚至可以用 <code>createdCallback()</code> 给一个元素赋予一些默认的 HTML：</p><pre class="language-js"><code><span class="token keyword">var</span> XFooProto <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>HTMLElement<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>

XFooProto<span class="token punctuation">.</span><span class="token function-variable function">createdCallback</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">&quot;&lt;b&gt;I’m an x-foo-with-markup!&lt;/b&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> XFoo <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">registerElement</span><span class="token punctuation">(</span><span class="token string">'x-foo-with-markup'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>prototype<span class="token punctuation">:</span> XFooProto<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>实例化这个标签并在 DevTools 中观察（右击，选择“审查元素”），可以看到如下结构：</p><pre class="language-html"><code>▾<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-foo-with-markup</span><span class="token punctuation">&gt;</span></span>
   <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>I’m an x-foo-with-markup!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-foo-with-markup</span><span class="token punctuation">&gt;</span></span>
</code></pre><h3 id="用-shadow-dom-封装内部实现"><a href="#用-shadow-dom-封装内部实现" aria-hidden="true" class="header-anchor">#</a> 用 Shadow DOM 封装内部实现</h3><p><a href="http://www.html5rocks.com/tutorials/webcomponents/shadowdom/" target="_blank" rel="noopener noreferrer">Shadow DOM</a> 本身是一个封装内容的强大工具，配合使用自定义元素就更神奇了！</p><p>Shadow DOM 为自定义元素提供了：</p><ol><li>一种隐藏内部实现的方法，从而将用户与血淋淋的实现细节隔离开。</li><li>简单有效的<a href="http://www.html5rocks.com/tutorials/webcomponents/shadowdom-201/" target="_blank" rel="noopener noreferrer">样式隔离</a>。</li></ol><p>从 Shadow DOM 创建元素，跟创建一个渲染基础标记的元素非常类似，区别在于 <code>createdCallback()</code> 回调：</p><pre class="language-js"><code><span class="token keyword">var</span> XFooProto <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>HTMLElement<span class="token punctuation">.</span>prototype<span class="token punctuation">)</span><span class="token punctuation">;</span>

XFooProto<span class="token punctuation">.</span><span class="token function-variable function">createdCallback</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1. 为元素附加一个 shadow root。</span>
  <span class="token keyword">var</span> shadow <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createShadowRoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 2. 填入标记。</span>
  shadow<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">&quot;&lt;b&gt;I’m in the element’s Shadow DOM!&lt;/b&gt;&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> XFoo <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">registerElement</span><span class="token punctuation">(</span><span class="token string">'x-foo-shadowdom'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>prototype<span class="token punctuation">:</span> XFooProto<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><p>我们并没有直接设置 <code>&lt;x-foo-shadowdom&gt;</code> 的 <code>innerHTML</code>，而是为其创建了一个用于填充标记的 Shadow Root。在 DevTools 设置中勾选“Show Shadow DOM”，你就会看到一个可以展开的 <code>#shadow-root</code>：</p><pre class="language-html"><code>▾<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-foo-shadowdom</span><span class="token punctuation">&gt;</span></span>
   ▾#shadow-root
     <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">&gt;</span></span>I’m in the element’s Shadow DOM!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">&gt;</span></span>
 <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-foo-shadowdom</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>这就是 Shadow Root！</p><h3 id="从模板创建元素"><a href="#从模板创建元素" aria-hidden="true" class="header-anchor">#</a> 从模板创建元素</h3><p><a href="http://www.whatwg.org/specs/web-apps/current-work/multipage/scripting-1.html#the-template-element" target="_blank" rel="noopener noreferrer">HTML 模板</a>是另一组跟自定义元素完美融合的新 API。</p><p><a href="http://www.html5rocks.com/tutorials/webcomponents/template/" target="_blank" rel="noopener noreferrer"><code>&lt;template&gt;</code> 元素</a>可用于声明 DOM 片段。它们可以被解析并在页面加载后插入，以及延迟到运行时才进行实例化。模板是声明自定义元素结构的理想方案。</p><p>**示例：**注册一个由 <code>&lt;template&gt;</code> 和 Shadow DOM 创建的元素：</p><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>sdtemplate<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style language-css">
    <span class="token selector">p</span> <span class="token punctuation">{</span> <span class="token property">color</span><span class="token punctuation">:</span> orange<span class="token punctuation">;</span> <span class="token punctuation">}</span>
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>I’m in Shadow DOM. My markup was stamped from a <span class="token entity" title="&">&amp;amp;</span>lt;template<span class="token entity" title="&">&amp;amp;</span>gt;.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
<span class="token keyword">var</span> proto <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>HTMLElement<span class="token punctuation">.</span>prototype<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  createdCallback<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    value<span class="token punctuation">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">var</span> t <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'#sdtemplate'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> clone <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">importNode</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>content<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createShadowRoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>clone<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
document<span class="token punctuation">.</span><span class="token function">registerElement</span><span class="token punctuation">(</span><span class="token string">'x-foo-from-template'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>prototype<span class="token punctuation">:</span> proto<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>短短几行做了很多事情，我们挨个来看都发生了些什么：</p><ol><li>我们在 HTML 中注册了一个新元素：<code>&lt;x-foo-from-template&gt;</code></li><li>这个元素的 DOM 是从一个 <code>&lt;template&gt;</code> 创建的</li><li>Shadow DOM 隐藏了该元素可怕的细节</li><li>Shadow DOM 也对元素的样式进行了隔离（比如 <code>p {color: orange;}</code> 不会把整个页面都搞成<span style="color: orange;">橙色</span>）</li></ol><p>真不错！</p><h2 id="为自定义元素增加样式"><a href="#为自定义元素增加样式" aria-hidden="true" class="header-anchor">#</a> 为自定义元素增加样式</h2><p>和其他 HTML 标签一样，自定义元素也可以用选择器定义样式：</p><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style language-css">
  <span class="token selector">app-panel</span> <span class="token punctuation">{</span>
    <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token selector">[is=&quot;x-item&quot;]</span> <span class="token punctuation">{</span>
    <span class="token property">transition</span><span class="token punctuation">:</span> opacity 400ms ease-in-out<span class="token punctuation">;</span>
    <span class="token property">opacity</span><span class="token punctuation">:</span> 0.3<span class="token punctuation">;</span>
    <span class="token property">flex</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
    <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
    <span class="token property">border-radius</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token selector">[is=&quot;x-item&quot;]:hover</span> <span class="token punctuation">{</span>
    <span class="token property">opacity</span><span class="token punctuation">:</span> 1.0<span class="token punctuation">;</span>
    <span class="token property">background</span><span class="token punctuation">:</span> <span class="token function">rgb</span><span class="token punctuation">(</span>255, 0, 255<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token property">color</span><span class="token punctuation">:</span> white<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token selector">app-panel &gt; [is=&quot;x-item&quot;]</span> <span class="token punctuation">{</span>
    <span class="token property">padding</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span>
    <span class="token property">list-style</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
    <span class="token property">margin</span><span class="token punctuation">:</span> 0 7px<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>app-panel</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">is</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>x-item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Do
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">is</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>x-item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Re
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">is</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>x-item<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Mi
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>app-panel</span><span class="token punctuation">&gt;</span></span>
</code></pre><h3 id="为使用-shadow-dom-的元素增加样式"><a href="#为使用-shadow-dom-的元素增加样式" aria-hidden="true" class="header-anchor">#</a> 为使用 Shadow DOM 的元素增加样式</h3><p>有了 Shadow DOM 场面就热闹得多了，它可以极大增强自定义元素的能力。</p><p>Shadow DOM 为元素增加了样式封装的特性。Shadow Root 中定义的样式不会暴露到宿主外部或对页面产生影响。**对自定义元素来说，元素本身就是宿主。**样式封装的属性也使得自定义元素能够为自己定义默认样式。</p><p>Shadow DOM 的样式是一个很大的话题！如果你想更多地了解它，推荐你阅读我写的其他文章：</p><ul><li><a href="http://www.polymer-project.org" target="_blank" rel="noopener noreferrer">Polymer</a> 文档：<a href="http://www.polymer-project.org/articles/styling-elements.html" target="_blank" rel="noopener noreferrer">元素样式指南</a>。</li><li>发表于 <a href="http://www.html5rocks.com/" target="_blank" rel="noopener noreferrer">HTML5Rocks</a> 的 <a href="http://www.html5rocks.com/tutorials/webcomponents/shadowdom-201/" target="_blank" rel="noopener noreferrer">Shadow DOM 201：CSS 和样式</a>。</li></ul><h3 id="使用-unresolved-伪类避免无样式内容闪烁（fouc）"><a href="#使用-unresolved-伪类避免无样式内容闪烁（fouc）" aria-hidden="true" class="header-anchor">#</a> 使用 <code>:unresolved</code> 伪类避免无样式内容闪烁（FOUC）</h3><p>为了缓解<a href="http://en.wikipedia.org/wiki/Flash_of_unstyled_content" target="_blank" rel="noopener noreferrer">无样式内容闪烁</a>的影响，自定义元素规范提出了一个新的 CSS 伪类 <code>:unresolved</code>。在浏览器调用你的 <code>createdCallback()</code>（见<strong>生命周期回调方法</strong>一节）之前，这个伪类都可以匹配到 unresolved 元素。一旦产生调用，就意味着元素已经完成提升，成为它被定义的形态，该元素就不再是一个 unresolved 元素了。</p><p>**提示：**Chrome 29 已经原生支持 CSS <code>:unresolved</code> 伪类。</p><p>**示例：**注册后渐显的 <code>&lt;x-foo&gt;</code> 标签：</p><pre class="language-css"><code><span class="token selector">x-foo</span> <span class="token punctuation">{</span>
  <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
  <span class="token property">transition</span><span class="token punctuation">:</span> opacity 300ms<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">x-foo:unresolved</span> <span class="token punctuation">{</span>
  <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><p>请记住 <code>:unresolved</code> 伪类只能用于 unresolved 元素，而不能用于继承自 <code>HTMLUnkownElement</code> 的元素（见<strong>元素如何提升</strong>一节）。</p><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style language-css">
  <span class="token comment">/* 给所有 unresolved 元素添加边框 */</span>
  <span class="token selector">:unresolved</span> <span class="token punctuation">{</span>
    <span class="token property">border</span><span class="token punctuation">:</span> 1px dashed red<span class="token punctuation">;</span>
    <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">/* unresolved 元素 x-panel 的文本内容为红色 */</span>
  <span class="token selector">x-panel:unresolved</span> <span class="token punctuation">{</span>
    <span class="token property">color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">/* 定义注册后的 x-panel 文本内容为绿色 */</span>
  <span class="token selector">x-panel</span> <span class="token punctuation">{</span>
    <span class="token property">color</span><span class="token punctuation">:</span> green<span class="token punctuation">;</span>
    <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>
    <span class="token property">padding</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span>
    <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>panel</span><span class="token punctuation">&gt;</span></span>
  I’m black because :unresolved doesn’t apply to “panel”.
  It’s not a valid custom element name.
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>panel</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>x-panel</span><span class="token punctuation">&gt;</span></span>I’m red because I match x-panel:unresolved.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>x-panel</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>了解更多 <code>:unresolved</code> 伪类的知识，请看 Polymer 文档<a href="http://www.polymer-project.org/articles/styling-elements.html#preventing-fouc" target="_blank" rel="noopener noreferrer">元素样式指南</a>。</p><h2 id="历史和浏览器支持"><a href="#历史和浏览器支持" aria-hidden="true" class="header-anchor">#</a> 历史和浏览器支持</h2><h3 id="特性检测"><a href="#特性检测" aria-hidden="true" class="header-anchor">#</a> 特性检测</h3><p>特性检测就是检查 <code>document.registerElement()</code> 是否存在：</p><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">supportsCustomElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token string">'registerElement'</span> <span class="token keyword">in</span> document<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">supportsCustomElements</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 使用自定义元素 API</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// 使用其他类库创建组件</span>
<span class="token punctuation">}</span>
</code></pre><h3 id="浏览器支持"><a href="#浏览器支持" aria-hidden="true" class="header-anchor">#</a> 浏览器支持</h3><p>Chrome 27 和 Firefox 23 都提供了对 <code>document.registerElement()</code> 的支持，不过之后规范又有一些演化。Chrome 31 将是第一个真正支持新规范的版本。</p><p>**提示：**在 Chrome 31 中使用自定义元素，需要开启 <em>about:flags</em> 中的“实验性 web 平台特性（Experimental Web Platform features）”选项。</p><p>在浏览器支持稳定之前，也有一些很好的兼容方案：</p><ul><li>Google 的 <a href="http://polymer-project.org" target="_blank" rel="noopener noreferrer">Polymer</a> 集成了一个<a href="http://www.polymer-project.org/platform/custom-elements.html" target="_blank" rel="noopener noreferrer">兼容方案</a></li><li>Mozilla 的 <a href="http://www.x-tags.org/" target="_blank" rel="noopener noreferrer">x-tags</a></li></ul><h3 id="htmlelementelement-怎么了？"><a href="#htmlelementelement-怎么了？" aria-hidden="true" class="header-anchor">#</a><code>HTMLElementElement</code> 怎么了？</h3><p>一直关注标准的人都知道曾经有一个 <code>&lt;element&gt;</code> 标签。它非常好用，你只要像下面这样就可以声明式地注册一个新元素：</p><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>element</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>my-element<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  ...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>element</span><span class="token punctuation">&gt;</span></span>
</code></pre><p>然而很不幸，在它的提升过程、极端用例，以及末日般的复杂场景中，需要处理大量的时序问题。<code>&lt;element&gt;</code> 因此被迫搁置。2013 年 8 月，Dimitri Glazkov 在 <a href="http://lists.w3.org/Archives/Public/public-webapps/2013JulSep/0287.html" target="_blank" rel="noopener noreferrer">public-webapps</a> 邮件组中宣告移除 <code>&lt;element&gt;</code>。</p><p>值得注意的是，Polymer 实现了以 <code>&lt;polymer-element&gt;</code> 的形式声明式地注册元素。这是怎么做到的？它用的正是 <code>document.registerElement('polymer-element')</code> 以及我在<strong>从模板创建元素</strong>一节介绍的技术。</p><h2 id="结语"><a href="#结语" aria-hidden="true" class="header-anchor">#</a> 结语</h2><p>自定义元素为我们提供了一个工具，通过它我们可以扩展 HTML 的词汇，赋予它新的特性，并把不同的 web 平台连接在一起。结合其他新的基本平台，如 Shadow DOM 和 <code>&lt;template&gt;</code>，我们领略了 web 组件的宏伟蓝图。标记语言将再次变得很时髦！</p><p>如果你对使用 web 组件感兴趣，建议你看看 <a href="http://polymer-project.org" target="_blank" rel="noopener noreferrer">Polymer</a>，它已经有了你想要的一切。</p></div><!----><!----></div></div></div>
    <script src="/assets/js/37.dbb122e4.js" defer></script><script src="/assets/js/app.d4ce6780.js" defer></script>
  </body>
</html>
