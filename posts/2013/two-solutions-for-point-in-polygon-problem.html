<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>一个平庸的码农 | 两种方法判断平面内的点是否在多边形内</title>
    <meta name="description" content="一个平庸的码农">
    <link rel="icon" href="/static/logo.png" type="image/png" sizes="256x256">
  <link rel="icon" href="/static/logo.svg" type="image/svg+xml" sizes="any">
  <link rel="stylesheet" href="/static/fontello.css">
    
    <link rel="preload" href="/assets/css/0.styles.ea168385.css" as="style"><link rel="preload" href="/assets/js/app.d4ce6780.js" as="script"><link rel="preload" href="/assets/js/31.57541ec8.js" as="script"><link rel="prefetch" href="/assets/js/28.ab8ea044.js"><link rel="prefetch" href="/assets/js/1.460b6d99.js"><link rel="prefetch" href="/assets/js/2.4585c69e.js"><link rel="prefetch" href="/assets/js/3.560fc6c4.js"><link rel="prefetch" href="/assets/js/4.b8e26cb0.js"><link rel="prefetch" href="/assets/js/5.a4031868.js"><link rel="prefetch" href="/assets/js/6.9508ab9a.js"><link rel="prefetch" href="/assets/js/7.fa73cd7e.js"><link rel="prefetch" href="/assets/js/8.de02dda4.js"><link rel="prefetch" href="/assets/js/9.4f05d119.js"><link rel="prefetch" href="/assets/js/10.ee35eaa0.js"><link rel="prefetch" href="/assets/js/11.2af52383.js"><link rel="prefetch" href="/assets/js/12.9cd5fd43.js"><link rel="prefetch" href="/assets/js/13.dfe3a00b.js"><link rel="prefetch" href="/assets/js/14.3476e7ae.js"><link rel="prefetch" href="/assets/js/15.e4be0105.js"><link rel="prefetch" href="/assets/js/16.5ea9c46d.js"><link rel="prefetch" href="/assets/js/17.b80775b3.js"><link rel="prefetch" href="/assets/js/18.d7b44c49.js"><link rel="prefetch" href="/assets/js/19.018a17cd.js"><link rel="prefetch" href="/assets/js/20.e7784bab.js"><link rel="prefetch" href="/assets/js/21.20740583.js"><link rel="prefetch" href="/assets/js/22.efb6ef79.js"><link rel="prefetch" href="/assets/js/23.b4bd3298.js"><link rel="prefetch" href="/assets/js/24.d5547775.js"><link rel="prefetch" href="/assets/js/25.46c855ac.js"><link rel="prefetch" href="/assets/js/26.d85c22d8.js"><link rel="prefetch" href="/assets/js/27.96361ded.js"><link rel="prefetch" href="/assets/js/29.2085f5ec.js"><link rel="prefetch" href="/assets/js/30.4f6ac586.js"><link rel="prefetch" href="/assets/js/32.dee6b356.js"><link rel="prefetch" href="/assets/js/33.72192c86.js"><link rel="prefetch" href="/assets/js/34.d1d397ef.js"><link rel="prefetch" href="/assets/js/35.131246cc.js"><link rel="prefetch" href="/assets/js/36.c62769a3.js"><link rel="prefetch" href="/assets/js/37.dbb122e4.js"><link rel="prefetch" href="/assets/js/38.2f4b3c78.js"><link rel="prefetch" href="/assets/js/39.25d82b38.js"><link rel="prefetch" href="/assets/js/40.f02cae42.js"><link rel="prefetch" href="/assets/js/41.85ab936e.js"><link rel="prefetch" href="/assets/js/42.1f378e94.js"><link rel="prefetch" href="/assets/js/43.d5c77d52.js"><link rel="prefetch" href="/assets/js/44.2f53e3cf.js"><link rel="prefetch" href="/assets/js/45.e8c2e103.js"><link rel="prefetch" href="/assets/js/46.42dd2bbd.js"><link rel="prefetch" href="/assets/js/47.600ab990.js"><link rel="prefetch" href="/assets/js/48.78c3d5fd.js"><link rel="prefetch" href="/assets/js/49.9fba5340.js"><link rel="prefetch" href="/assets/js/50.e2483df2.js"><link rel="prefetch" href="/assets/js/51.1ce8a129.js"><link rel="prefetch" href="/assets/js/52.d711cd4e.js"><link rel="prefetch" href="/assets/js/53.c7803802.js"><link rel="prefetch" href="/assets/js/54.bae792ff.js"><link rel="prefetch" href="/assets/js/55.7feea50b.js"><link rel="prefetch" href="/assets/js/56.2f16289f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.ea168385.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      一个平庸的码农
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/posts/" class="nav-link router-link-active">吹水</a></div><div class="nav-item"><a href="/books/" class="nav-link">图书</a></div><div class="nav-item"><a href="/projects/" class="nav-link">小玩意</a></div><div class="nav-item"><a href="/slides/" class="nav-link">投影片</a></div><div class="nav-item"><a href="/music/" class="nav-link">音乐</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">社区</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="https://github.com/myst729" target="_blank" rel="noopener noreferrer" class="nav-link">GitHub</a></li><li class="dropdown-item"><!----><a href="https://stackoverflow.com/users/1032492" target="_blank" rel="noopener noreferrer" class="nav-link">StackOverflow</a></li></ul></div></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/posts/" class="nav-link router-link-active">吹水</a></div><div class="nav-item"><a href="/books/" class="nav-link">图书</a></div><div class="nav-item"><a href="/projects/" class="nav-link">小玩意</a></div><div class="nav-item"><a href="/slides/" class="nav-link">投影片</a></div><div class="nav-item"><a href="/music/" class="nav-link">音乐</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">社区</span><span class="arrow right"></span></a><ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----><a href="https://github.com/myst729" target="_blank" rel="noopener noreferrer" class="nav-link">GitHub</a></li><li class="dropdown-item"><!----><a href="https://stackoverflow.com/users/1032492" target="_blank" rel="noopener noreferrer" class="nav-link">StackOverflow</a></li></ul></div></div><!----></nav><!----></div><div class="page"><div class="content"><h1 id="两种方法判断平面内的点是否在多边形内"><a href="#两种方法判断平面内的点是否在多边形内" aria-hidden="true" class="header-anchor">#</a> 两种方法判断平面内的点是否在多边形内</h1><p>前言：本文源于前几天看到的一条<a href="http://weibo.com/1057676857/Adpfwwfsv" target="_blank" rel="noopener noreferrer">微博</a>：</p><p><img src="https://myst729.github.io/blog/images/2013/11/weibo.png" alt="微博"></p><p>对于这种言论我并不赞同。我大学学的是化学，没有学习过计算机专业的课程，但我认为至少这个问题并不需要多么高端的计算机专业知识，只要中学数学没有全还给老师，就应该能给出至少一种解法。比如说，我就随便涂了一个多边形和一个点，现在我要找出一种通用的方法来判断这个点是不是在多边形内部（别告诉我用肉眼观察……）。</p><p><img src="https://myst729.github.io/blog/images/2013/11/problem.png" alt="问题"></p><p>首先想到的一个解法是从这个点做一条射线，计算它跟多边形边界的交点个数，如果交点个数为奇数，那么点在多边形内部，否则点在多边形外。</p><p><img src="https://myst729.github.io/blog/images/2013/11/solution.png" alt="思路"></p><p>这个结论很简单，那它是怎么来的？其实，对于平面内任意闭合曲线，我们都可以直观地认为，曲线把平面分割成了内、外两部分，其中“内”就是我们所谓的多边形区域。</p><p><img src="https://myst729.github.io/blog/images/2013/11/polygon.png" alt="多边形"></p><p>基于这一认识，对于平面内任意一条直线，我们可以得出下面这些结论：</p><ol><li>直线穿越多边形边界时，有且只有两种情况：<strong>进入</strong>多边形或<strong>穿出</strong>多边形。</li><li>在不考虑非欧空间的情况下，直线不可能从内部再次进入多边形，或从外部再次穿出多边形，即连续两次穿越边界的情况必然成对。</li><li>直线可以无限延伸，而闭合曲线包围的区域是有限的，因此最后一次穿越多边形边界，一定是穿出多边形，到达外部。</li></ol><p><img src="https://myst729.github.io/blog/images/2013/11/cross.png" alt="穿越"></p><p>现在回到我们最初的题目。假如我们从一个给定的点做射线，还可以得出下面两条结论：</p><ol><li>如果点在多边形内部，射线第一次穿越边界一定是穿出多边形。</li><li>如果点在多边形外部，射线第一次穿越边界一定是进入多边形。</li></ol><p><img src="https://myst729.github.io/blog/images/2013/11/first.png" alt="首次穿越"></p><p>把上面这些结论综合起来，我们可以归纳出：</p><ol><li>当射线穿越多边形边界的次数为偶数时，所有<strong>第偶数次</strong>（包括最后一次）穿越都是穿出，因此所有<strong>第奇数次</strong>（包括第一次）穿越为穿入，由此可推断点在多边形外部。</li></ol><p><img src="https://myst729.github.io/blog/images/2013/11/out.png" alt="外部"></p><ol start="2"><li>当射线穿越多边形边界的次数为奇数时，所有<strong>第奇数次</strong>（包括第一次和最后一次）穿越都是穿出，由此可推断点在多边形内部。</li></ol><p><img src="https://myst729.github.io/blog/images/2013/11/in.png" alt="内部"></p><p>到这里，我们已经了解这个解法的思路了，下面接着看算法实现的一些具体问题和边界条件的处理。</p><ol><li><strong>点在多边形的边上</strong></li></ol><p>上面我们讲到，这个解法的主要思路就是计算射线穿越多边形边界的次数，那么对于点在多边形的边上这种特殊情况，射线出发的这一次，是否应该算作穿越呢？</p><p><img src="https://myst729.github.io/blog/images/2013/11/side.png" alt="边"></p><p>看了上面的图就会发现，不管算不算穿越，都会陷入两难的境地——同样落在多边形边上的点，可能会得到相反的结果。这显然是不正确的，因此对这种特殊情况需要特殊处理。</p><ol start="2"><li><strong>点和多边形的顶点重合</strong></li></ol><p>这其实是第一种情况的一个特例。</p><p><img src="https://myst729.github.io/blog/images/2013/11/angle.png" alt="顶点"></p><ol start="3"><li><strong>射线经过多边形顶点</strong></li></ol><p>射线刚好经过多边形顶点的时候，应该算一次还是两次穿越？这种情况比前两种复杂，也是实现中的难点。</p><p><img src="https://myst729.github.io/blog/images/2013/11/corner.png" alt="边"></p><ol start="4"><li><strong>射线刚好经过多边形的一条边</strong></li></ol><p>这是上一种情况的特例，也就是说，射线连续经过了多边形的两个相邻顶点。</p><p><img src="https://myst729.github.io/blog/images/2013/11/line.png" alt="经过边"></p><p><strong>解决方案：</strong></p><ol><li><p>判断点是否在线上的方法有很多，比较简单直接的就是计算点与两个多边形顶点的连线斜率是否相等，中学数学都学过。</p></li><li><p>点和多边形顶点重合的情况更简单，直接比较点的坐标就行了。</p></li><li><p>顶点穿越看似棘手，其实我们换一个角度，思路会大不相同。先来回答一个问题，射线穿越一条线段需要什么前提条件？没错，就是线段两个端点分别在射线两侧。只要想通这一点，顶点穿越就迎刃而解了。这样一来，我们只需要规定被射线穿越的点都算作其中一侧。</p></li></ol><p><img src="https://myst729.github.io/blog/images/2013/11/divide.png" alt="两侧"></p><p>如上图，假如我们规定<strong>射线经过的点都属于射线以上的一侧</strong>，显然点 D 和发生顶点穿越的点 C 都位于射线 Y 的同一侧，所以射线 Y 其实并没有穿越 CD 这条边。而点 C 和点 B 则分别位于射线 Y 的两侧，所以射线 Y 和 BC 发生了穿越，由此我们可以断定点 Y 在多边形内。同理，射线 X 分别与 AD 和 CD 都发生了穿越，因此点 X 在多边形外，而射线 Z 没有和多边形发生穿越，点 Z 位于多边形外。</p><ol start="4"><li>解决了第三点，这一点就毫无难度了。根据上面的假设，射线连续经过的两个顶点显然都位于射线以上的一侧，因此这种情况看作没有发生穿越就可以了。由于第三点的解决方案实际上已经覆盖到这种特例，因此不需要再做特别的处理。</li></ol><p>这种简单直观的算法通常叫做<a href="http://en.wikipedia.org/wiki/Point_in_polygon#Ray_casting_algorithm" target="_blank" rel="noopener noreferrer">射线法</a>或<strong>奇偶法</strong>，下面给出 JavaScript 的算法实现。</p><pre class="language-js"><code><span class="token comment">/**
 * @description 射线法判断点是否在多边形内部
 * @param {Object} p 待判断的点，格式：{ x: X 坐标, y: Y 坐标 }
 * @param {Array} poly 多边形顶点，数组成员的格式同 p
 * @return {String} 点 p 和多边形 poly 的几何关系
 */</span>
<span class="token keyword">function</span> <span class="token function">rayCasting</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> poly<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> px <span class="token operator">=</span> p<span class="token punctuation">.</span>x<span class="token punctuation">,</span>
      py <span class="token operator">=</span> p<span class="token punctuation">.</span>y<span class="token punctuation">,</span>
      flag <span class="token operator">=</span> <span class="token boolean">false</span>

  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> poly<span class="token punctuation">.</span>length<span class="token punctuation">,</span> j <span class="token operator">=</span> l <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> j <span class="token operator">=</span> i<span class="token punctuation">,</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> sx <span class="token operator">=</span> poly<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span>
        sy <span class="token operator">=</span> poly<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">,</span>
        tx <span class="token operator">=</span> poly<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span>
        ty <span class="token operator">=</span> poly<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>y

    <span class="token comment">// 点与多边形顶点重合</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>sx <span class="token operator">===</span> px <span class="token operator">&amp;&amp;</span> sy <span class="token operator">===</span> py<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>tx <span class="token operator">===</span> px <span class="token operator">&amp;&amp;</span> ty <span class="token operator">===</span> py<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token string">'on'</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 判断线段两端点是否在射线两侧</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>sy <span class="token operator">&lt;</span> py <span class="token operator">&amp;&amp;</span> ty <span class="token operator">&gt;=</span> py<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>sy <span class="token operator">&gt;=</span> py <span class="token operator">&amp;&amp;</span> ty <span class="token operator">&lt;</span> py<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 线段上与射线 Y 坐标相同的点的 X 坐标</span>
      <span class="token keyword">var</span> x <span class="token operator">=</span> sx <span class="token operator">+</span> <span class="token punctuation">(</span>py <span class="token operator">-</span> sy<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>tx <span class="token operator">-</span> sx<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>ty <span class="token operator">-</span> sy<span class="token punctuation">)</span>

      <span class="token comment">// 点在多边形的边上</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>x <span class="token operator">===</span> px<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">'on'</span>
      <span class="token punctuation">}</span>

      <span class="token comment">// 射线穿过多边形的边界</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>x <span class="token operator">&gt;</span> px<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        flag <span class="token operator">=</span> <span class="token operator">!</span>flag
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 射线穿过多边形边界的次数为奇数时点在多边形内</span>
  <span class="token keyword">return</span> flag <span class="token operator">?</span> <span class="token string">'in'</span> <span class="token punctuation">:</span> <span class="token string">'out'</span>
<span class="token punctuation">}</span>
</code></pre><p>除了射线法还有很多其他的方法，下面再介绍一种<a href="http://en.wikipedia.org/wiki/Point_in_polygon#Winding_number_algorithm" target="_blank" rel="noopener noreferrer">回转数法</a>。</p><p>平面中的闭合曲线关于一个点的<a href="http://en.wikipedia.org/wiki/Winding_number" target="_blank" rel="noopener noreferrer">回转数</a>（又叫卷绕数），代表了曲线绕过该点的总次数。下面这张图动态演示了回转数的概念：图中红色曲线关于点（人所在位置）的回转数为 2。</p><p><img src="https://myst729.github.io/blog/images/2013/11/winding-number-animation.gif" alt="回转数"></p><p>回转数是拓扑学中的一个基本概念，具有很重要的性质和用途。本文并不打算在这一点上展开论述，这需要具备相当的数学知识，否则会非常乏味和难以理解。我们暂时只需要记住回转数的一个特性就行了：<strong>当回转数为 0 时，点在闭合曲线外部</strong>（回转数大于 0 时所代表的含义，大家可以自己想一想，还是很有趣的）。</p><p>对于给定的点和多边形，回转数应该怎么计算呢？</p><ol><li>用线段分别连接点和多边形的全部顶点。</li></ol><p><img src="https://myst729.github.io/blog/images/2013/11/lines.png" alt="顶点连线"></p><ol start="2"><li>计算所有点与相邻顶点连线的夹角。</li></ol><p><img src="https://myst729.github.io/blog/images/2013/11/angles-in.png" alt="内部"></p><ol start="3"><li>计算所有夹角和。注意每个夹角都是有方向的，所以有可能是负值。</li></ol><p><img src="https://myst729.github.io/blog/images/2013/11/angles-out.png" alt="外部"></p><ol start="4"><li>最后根据角度累加值计算回转数。看过前面的介绍，很容易理解 360°（2π）相当于一次回转。</li></ol><p>思路介绍完了，下面两点是实现中需要留意的问题。</p><ol><li>JavaScript 的数只有 64 位双精度浮点这一种。对于三角函数产生的无理数，浮点数计算不可避免会造成一些误差，因此在最后计算回转数时需要做取整操作。</li><li>通常情况下，平面直角坐标系内一个角的取值范围是 -π 到 π 这个区间，这也是 JavaScript 三角函数 <code>Math.atan2()</code> 返回值的范围。但 JavaScript 并不能直接计算任意两条线的夹角，我们只能先计算两条线与 X 正轴夹角，再取两者差值。这个差值的结果就有可能超出 -π 到 π 这个区间，因此我们还需要处理差值超出取值区间的情况。</li></ol><p>这里也给出回转数法的 JavaScript 实现。</p><pre class="language-js"><code><span class="token comment">/**
 * @description 回转数法判断点是否在多边形内部
 * @param {Object} p 待判断的点，格式：{ x: X 坐标, y: Y 坐标 }
 * @param {Array} poly 多边形顶点，数组成员的格式同 p
 * @return {String} 点 p 和多边形 poly 的几何关系
 */</span>
<span class="token keyword">function</span> <span class="token function">windingNumber</span><span class="token punctuation">(</span>p<span class="token punctuation">,</span> poly<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> px <span class="token operator">=</span> p<span class="token punctuation">.</span>x<span class="token punctuation">,</span>
      py <span class="token operator">=</span> p<span class="token punctuation">.</span>y<span class="token punctuation">,</span>
      sum <span class="token operator">=</span> <span class="token number">0</span>

  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> l <span class="token operator">=</span> poly<span class="token punctuation">.</span>length<span class="token punctuation">,</span> j <span class="token operator">=</span> l <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> l<span class="token punctuation">;</span> j <span class="token operator">=</span> i<span class="token punctuation">,</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> sx <span class="token operator">=</span> poly<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span>
        sy <span class="token operator">=</span> poly<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">,</span>
        tx <span class="token operator">=</span> poly<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span>
        ty <span class="token operator">=</span> poly<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>y

    <span class="token comment">// 点与多边形顶点重合或在多边形的边上</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>sx <span class="token operator">-</span> px<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>px <span class="token operator">-</span> tx<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>sy <span class="token operator">-</span> py<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>py <span class="token operator">-</span> ty<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>px <span class="token operator">-</span> sx<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>ty <span class="token operator">-</span> sy<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token punctuation">(</span>py <span class="token operator">-</span> sy<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>tx <span class="token operator">-</span> sx<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token string">'on'</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 点与相邻顶点连线的夹角</span>
    <span class="token keyword">var</span> angle <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">atan2</span><span class="token punctuation">(</span>sy <span class="token operator">-</span> py<span class="token punctuation">,</span> sx <span class="token operator">-</span> px<span class="token punctuation">)</span> <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token function">atan2</span><span class="token punctuation">(</span>ty <span class="token operator">-</span> py<span class="token punctuation">,</span> tx <span class="token operator">-</span> px<span class="token punctuation">)</span>

    <span class="token comment">// 确保夹角不超出取值范围（-π 到 π）</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>angle <span class="token operator">&gt;=</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      angle <span class="token operator">=</span> angle <span class="token operator">-</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>angle <span class="token operator">&lt;=</span> <span class="token operator">-</span>Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      angle <span class="token operator">=</span> angle <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span> <span class="token operator">*</span> <span class="token number">2</span>
    <span class="token punctuation">}</span>

    sum <span class="token operator">+=</span> angle
  <span class="token punctuation">}</span>

  <span class="token comment">// 计算回转数并判断点和多边形的几何关系</span>
  <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>sum <span class="token operator">/</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token string">'out'</span> <span class="token punctuation">:</span> <span class="token string">'in'</span>
<span class="token punctuation">}</span>
</code></pre><p>最后给一个<a href="https://myst729.github.io/point-in-polygon/" target="_blank" rel="noopener noreferrer">在线演示</a>。</p><p>补：也有人问到像下面这种复杂多边形有没有办法？答案是肯定的。至于为什么，就留给大家思考吧。</p><p><img src="https://myst729.github.io/blog/images/2013/11/complex-polygon.png" alt="Complex Polygon"></p></div><!----><!----></div></div></div>
    <script src="/assets/js/31.57541ec8.js" defer></script><script src="/assets/js/app.d4ce6780.js" defer></script>
  </body>
</html>
